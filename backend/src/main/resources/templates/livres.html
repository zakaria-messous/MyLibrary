<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Livres</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center mb-4">Gestion des Livres</h1>
    <button class="btn btn-danger mb-3" onclick="logout()">Se Déconnecter</button>

    <!-- Liste des livres -->
    <div class="mb-5">
        <h2>Liste des Livres</h2>
        <button class="btn btn-primary mb-3" id="fetchAll">Afficher tous les livres</button>
        <table class="table table-striped" id="livresTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>Titre</th>
                <th>Auteur</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <!-- Les lignes seront ajoutées dynamiquement -->
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // Vérifier l'authentification
    document.addEventListener('DOMContentLoaded', () => {
        const token = localStorage.getItem('authToken');
        if (!token) {
            alert('Vous devez vous connecter pour accéder à cette page.');
            window.location.href = 'login.html';
        }
    });

    // Injecter le token dans toutes les requêtes Axios
    axios.interceptors.request.use(config => {
        const token = localStorage.getItem('authToken');
        if (token) {
            config.headers.Authorization = `Bearer ${token}`;
        }
        return config;
    }, error => {
        return Promise.reject(error);
    });

    // Bouton de déconnexion
    function logout() {
        localStorage.removeItem('authToken');
        window.location.href = 'login.html';
    }

    // Afficher tous les livres
    document.getElementById('fetchAll').addEventListener('click', () => {
        axios.get('/livre')
            .then(response => {
                const tbody = document.querySelector('#livresTable tbody');
                tbody.innerHTML = '';
                response.data.forEach(livre => {
                    const row = `<tr>
                            <td>${livre.id}</td>
                            <td>${livre.titre}</td>
                            <td>${livre.auteur}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteLivre(${livre.id})">Supprimer</button>
                            </td>
                        </tr>`;
                    tbody.innerHTML += row;
                });
            })
            .catch(error => console.error(error));
    });

    // Supprimer un livre
    function deleteLivre(id) {
        axios.delete(`/livre/${id}`)
            .then(() => alert('Livre supprimé avec succès !'))
            .catch(error => console.error(error));
    }
</script>
</body>
</html>
